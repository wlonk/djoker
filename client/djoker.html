<head>
  <title>djoker</title>
</head>

<body>
  <div class="navbar">
    <div class="navbar-inner">
      <a class="brand" href="/">djoker</a>
      <ul class="nav pull-right">
        <li>
          <a>
            {{loginButtons align="right"}}
          </a>
        </li>
      </ul>
    </div>
  </div>

  <div class="container">
    <div class="row-fluid">
      <div class="span3">
        {{> tableList}}
      </div>
      <div class="span9">
        {{> displayController}}
      </div>
    </div>
  </div>
</body>

<template name="displayController">
  {{#if showCreateTableDialog}}
    {{> createTableDialog}}
  {{/if}}
  {{#if loading}}
    <div class="subtle">
      Loading&hellip;
    </div>
  {{else}}
    {{#if tableId}}
      {{> table}}
    {{else}}
      {{> home}}
    {{/if}}
  {{/if}}
</template>

<template name="home">
  <h1>Djoker</h1>
  <p>Welcome to Djoker!</p>
</template>

<template name="table">
  {{#if showAdjustVisibilityDialog}}
    {{> adjustVisibilityDialog}}
  {{/if}}

  {{#if loggedIn userId}}
    {{#if showCreatePileDialog}}
      {{> createPileDialog}}
    {{/if}}
  {{/if}}

  <div id="table-header">
    {{#if loggedIn userId}}
      <button class="pull-right btn btn-primary create-pile">create pile</button>
    {{/if}}
    <h1>{{tableName}}</h1>
  </div>

  <div class="clearfix"></div>

  {{#each piles}}
    <div class="pile-wrapper">
      <span class="pile-name">{{name}}</span>
      <div class="pile clearfix">
        {{#if visible userId visibleTo}}
          {{#each cards}}
            <div class="card {{suit}}{{#if inSelected _id}} selected{{/if}}">
              {{value}}
            </div>
          {{/each}}
        {{else}}
          {{#each cards}}
          <div class="card facedown{{#if inSelected _id}} selected{{/if}}">
            ?
          </div>
          {{/each}}
        {{/if}}
      </div>
      {{#if loggedIn userId}}
        <div class="pile-controls button-toolbar pull-right">
          <div class="btn-group">
            <button class="btn btn-small move-to-here"><i class="icon-magnet"></i></button>
            <button class="btn btn-small shuffle"><i class="icon-random"></i></button>
            <button class="btn btn-small sort"><i class="icon-list"></i></button>
          </div>
          <div class="btn-group">
            <button class="btn btn-small {{#if pileVisibility visibleTo "all"}}active {{/if}}reveal-this-pile"><i class="icon-eye-open"></i></button>
            <button class="btn btn-small {{#if pileVisibility visibleTo "some"}}active {{/if}}adjust-visibility-on-this-pile"><i class="icon-adjust"></i></button>
            <button class="btn btn-small {{#if pileVisibility visibleTo "none"}}active {{/if}}facedown-this-pile"><i class="icon-eye-close"></i></button>
          </div>
          <div class="btn-group">
            <button class="btn btn-small btn-danger trash-this-pile"><i class="icon-trash"></i></button>
          </div>
        </div>
      {{/if}}
    </div>
  {{/each}}
</template>

<template name="adjustVisibilityDialog">
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close done">&times;</button>
      <h3>Adjust visibility</h3>
    </div>

    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          {{#each users}}
            <div class="control-group">
              <label class="control-label" for="user_{{_id}}">{{displayName}}</label>
              <div class="controls">
                <input type="checkbox" id="user_{{_id}}" name="user_{{_id}}" data-id="{{_id}}"{{#if isViewer _id pileId}} checked{{/if}}>
              </div>
            </div>
          {{/each}}
        </fieldset>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary save">save</button>
      <button class="btn btn-primary done">cancel</button>
    </div>
  </div>
</template>

<template name="createPileDialog">
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close done">&times;</button>
      <h3>Create pile</h3>
    </div>

    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="control-group">
            <label class="control-label" for="name">Pile name</label>
            <div class="controls">
              <input type="text" id="name" name="name" placeholder="Deck" autofocus>
            </div>
          </div>
          <div class="control-group">
            <label class="control-label" for="deck">Pile type</label>
            <div class="controls">
              <select id="deck" name="deck">
                {{#each deck_types}}
                  <option value="{{value}}">{{name}}</option>
                {{/each}}
              </select>
            </div>
          </div>
        </fieldset>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary save">create</button>
      <button class="btn btn-primary done">cancel</button>
    </div>
  </div>
</template>

<template name="createTableDialog">
  <div class="modal">
    <div class="modal-header">
      <button type="button" class="close done">&times;</button>
      <h3>Create table</h3>
    </div>

    <div class="modal-body">
      <form class="form-horizontal">
        <fieldset>
          <div class="control-group">
            <label class="control-label" for="name">Table name</label>
            <div class="controls">
              <input type="text" id="name" name="name" autofocus>
            </div>
          </div>
        </fieldset>
      </form>
    </div>

    <div class="modal-footer">
      <button class="btn btn-primary save">create</button>
      <button class="btn btn-primary done">cancel</button>
    </div>
  </div>
</template>

<template name="tableList">
  <h2>Tables:</h2>
  <ul>
    {{#each tables}}
      <li><a href="/{{_id}}">{{ name }}</a></li>
    {{/each}}
  </ul>
  <button class="btn btn-primary create-table">create table</button>
</template>
